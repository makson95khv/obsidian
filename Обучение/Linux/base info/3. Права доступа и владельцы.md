## Пользователи и группы
### Пользователи
`w` - выведет активных пользователей
`who` - вывод информации об активных пользователях
- `-b` - последняя загрузка системы
- `-H` - показ заголовков
- `-qH` - залогиненные пользователи
- `-uH` - покажет более подробно о логинах
`users` - вывод пользователей, работающих в системе одной строкой (**/var/run/utmp**)
`last` - вывод пользователей, входивших в систему (**/var/run/wtmp**)
`lastb` - вывод неудачных попыток входа (**/var/run/btmp**)
`useradd` - создание пользователя
- `-d` - указание домашней папки
- `-g` - указание группы (по id)
- `-G` - указать все требуемые группы (по названию)
- `-m` - сразу создать домашний каталог (по умолчанию создается при входе)
- `-p` - задать пароль при создании
- `-s` - задать оболочку
- `-u` - задать пользователю id
- `-D` - покажет параметры, выставленные по умолчанию, для создания пользователя (`useradd -D`)
`usermod` - утилита для изменения параметров УЗ (в целом работает большинство параметров из *useradd*)
- `-L` - заблокировать УЗ
- `-U` - разблокировать УЗ
- `-aG` - добавить новую группу
`userdel` - удаление пользователя
- `-r` - удалить домашнюю папку
`ulimit` - установка лимитов на пользователя (ограничения на сессию. Для глобальных настроек - **/etc/security/limit.conf**)
- `-a` - вывести установленные лимиты
- `-u` - ограничение процессов пользователя
`adduser` - более понятная и интерактивная утилита для создания пользователя
`sudo mkhomedir_helper name` - создать домашнюю папку существующему пользователю
`passwd {user}` - сменить пароль пользователю (`gpasswd` - пароль на группу)
`groups {user}` - покажет группы, в которых состоит пользователь
`id {user}` - узнать параметры пользователя (uid, guid, группы и т.д.)
`su` - сменить пользователя, либо выполнить команду от имени другого пользователя (`su username -c "команда"` - не забывать про *кавычки*)
## Суперпользователь
`su` - переход на рута
- `su -c 'команда'` - выполнить от имени рута
`sudo` - выполнение от имени рута
- `-s` - перейдет под рута, оставаясь в домашней папке
- `-K` - очищает запомненный пароль
`visudo` - редактирует файл **/etc/sudoers** (файл с правами для групп и пользователей)
```
"root ALL=(ALL:ALL) ALL" - говорит о том, что пользователь root может выполнять с ЛЮБОЙ машины (первый ALL), от имени любого пользователя (второй ALL) или любой группы (третий ALL) любую команду (четвертый ALL)

"%admin ALL=(ALL) ALL" - то же самое, %admin тут - это группа.
```
### Группы
`groupadd` - создать группу
- `-g` - задать id
- `-p` - установить пароль на группу
`groupmod` - изменить параметры группы
- `-g` - изменить id
`groupdel` - удалить группу
### Прочее
`sudo chage -l {user}` - информация о пользователе (активна/не активна, смена пароля и т.д.)
`getent` - просмотр информации
- `getent group {name}` - выведет информацию о группе
- `getent passwd {username}`- выведет из файла информацию только по выбранному юзеру
## Права
`chown` - смена владельца/группы (`sudo chown -R user:user /mnt/folder` - меняет владельца и группу для папки folder и всего содержимого) 
- `-R` - рекурсивно меняет для каталога и всего вложенного
`chgrp` - поменять группу (можно через chown)
`chmod` - разрешение/запрет на файл. Пример использования: `chmod ugo+x {имя файла}` - даст права на выполнение (x) всем (u-users, g-grous, o-others). По аналогии можно убирать права через "-". Если использовать "=" - можно выставить только указанные права. По цифрам - **r=4, w=2, x=1** (Например `chmod 750` сделает права вида - `rwx.r-x.---`) Так же, например, можно сделать - `chmod -R o+X /catalog` даст права на выполнение каталогу "catalog" и всем каталогам внутри, **но!** не даст эти права файлам внутри каталога.
### Специальные права
Так же существуют расширенные права:
- *SUID* - права, при которых файл будет запускаться от другого пользователя. В правах отображается как "rw**S**" (пример /usr/bin/passwd)
- *SGID* - то же самое, но для групп
- *StickiBit* - для защиты от случайного удаления. Удалить файлы сможет только пользователь-владелец файла, либо пользователь-владелец каталога с файлом
Устанавливается **перед** основными правами:
- например: **4**755 - установлен suid и т.д.
- или `chmod u+s script`, `chmod g+s script`, `chmod o+t script`

`getfacl {имя файла}` - посмотреть текущие права на файл
`setfacl {имя файла}` - установить права на файл. Идея в том, что можно настроить права избирательно (Например конкретным пользователям из одной группы, а не всей группе)
`umask` - маска создания файлов и папок
- Указывает с какими правами по умолчанию будет создаваться объект (по принципу вычитания из максимальных прав: 777- папки, 666 - файлы)
- Например: `umask 022` означает, что все папки будут создаваться с разрешением **777-022=755 (т.е. rwxr-xr-x)**
`suid` - бит запуска от имени владельца (ставят на файлы)
- Если другой пользователь запустит файл, то он будет запущен от имени владельца
`sgid` - бит запуска от имени группы владельцев (ставят на папки)
- Запустит файл от имени группы владельца файла.
`sticky` - бит защиты содержимого (ставят на папки)

![[Права (таблица).png]]
![[Права sgid, suid, sticky (таблица).png]]